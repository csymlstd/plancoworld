<template>
  <div id="app">
    <nav class="navbar" :class="{ 'transparent': isHome }">
        <div class="navbar-brand">
          <router-link class="navbar-item logo" to="/">PlanCo World</router-link>
        </div>

        <div class="navbar-menu">
          <div class="navbar-start">
            <router-link :to="{ name: 'Parks' }" class="navbar-item">Parks</router-link>
            <router-link :to="{ name: 'Blueprints' }" class="navbar-item">Blueprints</router-link>
            <router-link :to="{ name: 'Billboards' }" class="navbar-item">Billboards</router-link>
            <!-- <router-link :to="{ name: 'Audio' }" class="navbar-item">Audio</router-link> -->
            <div class="navbar-item has-dropdown is-hoverable">
              <a class="navbar-link"><span class="icon"><i class="far fa-lg fa-ellipsis-h"></i></span></a>
              <div class="navbar-dropdown is-right">
                <a href="http://steamcommunity.com/app/493340/workshop/" target="_blank" class="navbar-item">Workshop</a>
                <a href="https://www.reddit.com/r/PlanetCoaster/" target="_blank" class="navbar-item">r/PlanetCoaster</a>
                <hr class="dropdown-divider" />
                <a href="https://www.reddit.com/r/PlanCoWorld/" target="_blank" class="navbar-item">r/PlanCoWorld</a>
                <router-link :to="{ name: 'ImportPark' }" class="navbar-item">Roadmap</router-link>
                <router-link :to="{ name: 'ImportPark' }" class="navbar-item">About</router-link>
              </div>
            </div>
          </div>
          <div class="navbar-end">
          <div class="navbar-item">
            <Search @selected="go" placeholder="Search for a coaster"></Search>
          </div>
          <div class="navbar-item has-dropdown is-hoverable" v-if="user.authenticated">
            <a class="navbar-link"><span class="icon"><i class="fas fa-plus-circle"></i></span></a>
            <div class="navbar-dropdown is-right">
              <router-link :to="{ name: 'ImportPark' }" class="navbar-item">Park</router-link>
              <router-link :to="{ name: 'ImportBlueprint' }" class="navbar-item">Blueprint</router-link>
              <router-link :to="{ name: 'ImportBillboard' }" class="navbar-item">Billboard</router-link>
              <!-- <router-link  class="navbar-item">Audio</router-link> -->
              <hr class="dropdown-divider" />
              <router-link :to="{ name: 'Convert' }" class="navbar-item">Converter</router-link>
              <router-link :to="{ name: 'Generator' }" class="navbar-item">Generator</router-link>
            </div>
          </div>
          <UserMenu v-if="user.authenticated"></UserMenu>
          <Login :steamOnly="true" v-if="!user.authenticated && !isHome" class="navbar-item"></Login>
        </div>
        </div>
    </nav>
    <vs-notify group="notifications"></vs-notify>
    <Toolbox v-if="user.authenticated" ref="toolbox"></Toolbox>
    <router-view></router-view>

    <Modal @close="closeLogin" :show="loginOpen">
      <div>
        <h2 class="title has-text-centered has-text-primary">Login to PlanCo World</h2>
        <Login v-if="!user.authenticated && !isHome" class="navbar-item"></Login>
      </div>
    </Modal>


    <footer class="main">
      <div class="container">
        <p class="description">PlanCo World &copy; 2017. <br /> We are not affiliated with Planet Coaster, Frontier Developments or its licensors. <span class="planco" title="Buldcrefs">Trademarks</span> are the property of their respective owners.</p>
      </div>
    </footer>
  </div>
</template>

<script>
import { store } from '@/store.js'

import router from '@/router'
import auth from '@/services/auth'
import '@/components/ui/Notify'
import Login from '@/components/Login'
import Toolbox from '@/components/Toolbox'
import Modal from '@/components/ui/Modal'
import UserMenu from '@/components/ui/UserMenu'
import Search from '@/components/ui/Search'

import '@/styles/vendors/_fontawesome-pro-core.scss';
import '@/styles/vendors/_fontawesome-pro-brands.scss';
import '@/styles/vendors/_fontawesome-pro-regular.scss';
import '@/styles/vendors/_fontawesome-pro-solid.scss';

import 'quill/dist/quill.core.css'
import 'quill/dist/quill.snow.css'

auth.checkAuth()

export default {
  store,
  data() {
    return {
      user: auth.user,
      isHome: false
    }
  },
  watch: {
    $route () {
      console.log(this.$route.path)
      if(this.$route.path === '/') {
        this.isHome = true
      } else {
        this.isHome = false
      }
    }
  },
  computed: {
    loginOpen() {
      return this.$store.state.modals.login
    }
  },
  components: {
    Toolbox,
    UserMenu,
    Modal,
    Search,
    Login
  },
  methods: {
    go(match) {
      let type = match._type
      let name = type.charAt(0).toUpperCase() + type.slice(1)
      router.push({ name, params: { slug: match._source.slug }})
    },
    closeLogin(e) {
      this.$store.commit('toggleModal',{ modal: 'login' })
    }
  },
  mounted () {
    if(this.$route.path === '/') {
      this.isHome = true
    } else {
      this.isHome = false
    }
  }
}
</script>

<!-- BUG: using lang="scss" causes relative file issue with $icons-font-path set in styles/_app.scss -->
<style>
[v-cloak] {
  display: none!important;
}
</style>
